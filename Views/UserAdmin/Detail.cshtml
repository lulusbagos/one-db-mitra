@model one_db_mitra.Models.Admin.UserDetailViewModel
@{
    ViewData["Title"] = "Detail User";
}

<div class="container-fluid px-0">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
            <p class="text-uppercase text-secondary small mb-1">Pengaturan</p>
            <h2 class="mb-0">Detail User</h2>
            <p class="text-secondary mb-0">Riwayat perubahan per field untuk user terpilih.</p>
        </div>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary" asp-action="Index">Kembali</a>
            <a class="btn btn-primary" asp-action="Edit" asp-route-id="@Model.UserId">Edit</a>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="text-secondary small">Username</div>
                    <div class="fw-semibold">@Model.Username</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Nama</div>
                    <div class="fw-semibold">@Model.FullName</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Email</div>
                    <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(Model.Email) ? Model.Email : "-")</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Perusahaan</div>
                    <div class="fw-semibold">@Model.CompanyName</div>
                    <div class="d-flex flex-wrap gap-1 mt-2">
                        @if (!string.IsNullOrWhiteSpace(Model.HierarchyOwner))
                        {
                            <span class="badge text-bg-primary">Owner: @Model.HierarchyOwner</span>
                        }
                        @if (Model.HierarchyLevel >= 1 && !string.IsNullOrWhiteSpace(Model.HierarchyMainContractor))
                        {
                            <span class="badge text-bg-info">Main: @Model.HierarchyMainContractor</span>
                        }
                        @if (Model.HierarchyLevel >= 2 && !string.IsNullOrWhiteSpace(Model.HierarchySubContractor))
                        {
                            <span class="badge text-bg-warning">Sub: @Model.HierarchySubContractor</span>
                        }
                        @if (Model.HierarchyLevel >= 3 && !string.IsNullOrWhiteSpace(Model.HierarchyVendor))
                        {
                            <span class="badge text-bg-secondary">Vendor: @Model.HierarchyVendor</span>
                        }
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Role</div>
                    <div class="fw-semibold">@Model.RoleName</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Status</div>
                    <span class="badge @(Model.IsActive ? "text-bg-success" : "text-bg-secondary")">
                        @(Model.IsActive ? "Aktif" : "Nonaktif")
                    </span>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Departemen</div>
                    <div class="fw-semibold">@Model.DepartmentName</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Section</div>
                    <div class="fw-semibold">@Model.SectionName</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Jabatan</div>
                    <div class="fw-semibold">@Model.PositionName</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Created</div>
                    <div class="fw-semibold">@Model.CreatedAt?.ToLocalTime().ToString("dd MMM yyyy HH:mm")</div>
                </div>
                <div class="col-md-4">
                    <div class="text-secondary small">Updated</div>
                    <div class="fw-semibold">@Model.UpdatedAt?.ToLocalTime().ToString("dd MMM yyyy HH:mm")</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Audit Trail (Per Field)</h6>
            <span class="badge text-bg-light">@Model.AuditTrail.Count</span>
        </div>
        <div class="card-body table-responsive">
            @if (Model.AuditTrail.Count == 0)
            {
                <div class="text-secondary">Belum ada perubahan tercatat.</div>
            }
            else
            {
                <table class="table table-striped align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Old</th>
                            <th>New</th>
                            <th>Waktu</th>
                            <th>Oleh</th>
                            <th>Sumber</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.AuditTrail)
                        {
                            <tr>
                                <td>@item.FieldName</td>
                                <td>@(string.IsNullOrWhiteSpace(item.OldValue) ? "-" : item.OldValue)</td>
                                <td>@(string.IsNullOrWhiteSpace(item.NewValue) ? "-" : item.NewValue)</td>
                                <td>@item.ChangedAt.ToLocalTime().ToString("dd MMM yyyy HH:mm")</td>
                                <td>@(string.IsNullOrWhiteSpace(item.ChangedBy) ? "-" : item.ChangedBy)</td>
                                <td>@(string.IsNullOrWhiteSpace(item.Source) ? "-" : item.Source)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </div>
</div>
