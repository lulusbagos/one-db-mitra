@model one_db_mitra.Models.Admin.KaryawanDetailViewModel
@using System
@{
    ViewData["Title"] = "Detail Karyawan";
    string FormatDate(DateTime? value) => value.HasValue ? value.Value.ToString("dd MMM yyyy") : "-";
    var penempatan = Model.Penempatan ?? Array.Empty<one_db_mitra.Models.Admin.KaryawanPenempatanItem>();
    var dokumen = Model.Dokumen ?? Array.Empty<one_db_mitra.Models.Admin.KaryawanDokumenItem>();
    var pendidikan = Model.Pendidikan ?? Array.Empty<one_db_mitra.Models.Admin.KaryawanPendidikanItem>();
    var vaksin = Model.Vaksin ?? Array.Empty<one_db_mitra.Models.Admin.KaryawanVaksinItem>();
    var pelanggaran = Model.Pelanggaran ?? Array.Empty<one_db_mitra.Models.Admin.KaryawanPelanggaranItem>();
    var auditTrail = Model.AuditTrail ?? Array.Empty<one_db_mitra.Models.Admin.KaryawanAuditItem>();
    var safetyCount = pelanggaran.Count(p => (p.Jenis ?? string.Empty).Equals("Safety", StringComparison.OrdinalIgnoreCase));
    var hrCount = pelanggaran.Count(p => (p.Jenis ?? string.Empty).Equals("HR", StringComparison.OrdinalIgnoreCase));
    var filterFrom = ViewBag.FilterFrom as DateTime?;
    var filterTo = ViewBag.FilterTo as DateTime?;
    var lastNonaktifDate = ViewBag.LastNonaktifDate as DateTime?;

    string Show(string? value) => !string.IsNullOrWhiteSpace(value) ? value : "-";
    string ShowInt(int? value) => value.HasValue ? value.Value.ToString() : "-";

    string FormatSumber(string? sumber)
    {
        if (string.IsNullOrWhiteSpace(sumber)) return "Lainnya";
        return sumber.Trim().ToLowerInvariant() switch
        {
            "rekrut" => "Rekrut",
            "import" => "Import",
            "edit" => "Mutasi",
            "rehire" => "Rehire",
            "kontrak" => "Kontrak",
            _ => sumber
        };
    }
}

<div class="karyawan-detail-header">
    <div class="d-flex flex-column flex-lg-row justify-content-between gap-3 text-white">
        <div>
            <span class="badge karyawan-badge mb-2">
                <i class="bi bi-person-badge me-2"></i>Profil Karyawan
            </span>
            <h2 class="mb-1 fw-bold">@Model.NamaLengkap</h2>
            <p class="mb-0 text-white-50">NIK: @Model.NoNik</p>
        </div>
        <div class="d-flex gap-2 align-items-start">
            <a class="btn btn-light fw-semibold" asp-action="Index">
                <i class="bi bi-arrow-left me-2"></i>Kembali
            </a>
            @if ((ViewBag.IsBlacklisted as bool?) == true && (ViewBag.IsOwner as bool?) == true)
            {
                <form asp-action="ClearBlacklist" asp-route-id="@Model.KaryawanId" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-outline-danger fw-semibold" onclick="return confirm('Buka blacklist karyawan ini?');">
                        <i class="bi bi-unlock me-2"></i>Buka Blacklist
                    </button>
                </form>
            }
        </div>
    </div>
</div>

<div class="container-fluid px-0 karyawan-body">
    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-body text-center">
                    @if (!string.IsNullOrWhiteSpace(Model.PhotoUrl))
                    {
                        <img src="@Model.PhotoUrl" alt="Foto Karyawan" class="karyawan-photo-lg mb-3" />
                    }
                    else
                    {
                        <div class="karyawan-photo-lg karyawan-photo-empty mb-3">
                            <i class="bi bi-person-circle"></i>
                        </div>
                    }
                    <h4 class="fw-bold mb-1">@Model.NamaLengkap</h4>
                    <p class="text-secondary mb-2">@Model.PositionName</p>
                    <div class="d-flex justify-content-center flex-wrap gap-2 mb-3">
                        <span class="badge text-bg-light">@Model.CompanyName</span>
                        <span class="badge text-bg-light">@Model.DepartmentName</span>
                        <span class="badge text-bg-light">@Model.SectionName</span>
                    </div>
                    <div class="d-flex justify-content-center flex-wrap gap-2 mb-3">
                        @if (!string.IsNullOrWhiteSpace(Model.HierarchyOwner))
                        {
                            <span class="badge text-bg-primary">Owner: @Model.HierarchyOwner</span>
                        }
                        @if (Model.HierarchyLevel >= 1 && !string.IsNullOrWhiteSpace(Model.HierarchyMainContractor))
                        {
                            <span class="badge text-bg-info">Main: @Model.HierarchyMainContractor</span>
                        }
                        @if (Model.HierarchyLevel >= 2 && !string.IsNullOrWhiteSpace(Model.HierarchySubContractor))
                        {
                            <span class="badge text-bg-warning">Sub: @Model.HierarchySubContractor</span>
                        }
                        @if (Model.HierarchyLevel >= 3 && !string.IsNullOrWhiteSpace(Model.HierarchyVendor))
                        {
                            <span class="badge text-bg-secondary">Vendor: @Model.HierarchyVendor</span>
                        }
                    </div>
                    <div class="d-flex justify-content-center gap-2">
                        <span class="badge @(Model.IsActive ? "text-bg-success" : "text-bg-secondary")">
                            @(Model.IsActive ? "Aktif" : "Nonaktif")
                        </span>
                        <span class="badge text-bg-info">Masuk: @FormatDate(Model.TanggalMasuk)</span>
                    </div>
                    <div class="mt-3 d-flex flex-column align-items-center gap-2">
                        <div class="small text-secondary">Pelanggaran</div>
                        <div class="d-flex flex-wrap justify-content-center gap-2">
                            <div class="d-flex align-items-center gap-1 text-danger">
                                @for (var i = 0; i < safetyCount; i++)
                                {
                                    <i class="bi bi-star-fill"></i>
                                }
                                <span class="small">@safetyCount Safety</span>
                            </div>
                            <div class="d-flex align-items-center gap-1 text-primary">
                                @for (var i = 0; i < hrCount; i++)
                                {
                                    <i class="bi bi-star-fill"></i>
                                }
                                <span class="small">@hrCount HR</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-white">
                    <div class="d-flex flex-column gap-2">
                        <div class="d-flex justify-content-between text-secondary small">
                            <span>Email Pribadi</span>
                            <span class="text-dark">@(!string.IsNullOrWhiteSpace(Model.EmailPribadi) ? Model.EmailPribadi : "-")</span>
                        </div>
                        <div class="d-flex justify-content-between text-secondary small">
                            <span>Email Kantor</span>
                            <span class="text-dark">@(!string.IsNullOrWhiteSpace(Model.EmailKantor) ? Model.EmailKantor : "-")</span>
                        </div>
                        <div class="d-flex justify-content-between text-secondary small">
                            <span>Telepon</span>
                            <span class="text-dark">@(!string.IsNullOrWhiteSpace(Model.Phone) ? Model.Phone : "-")</span>
                        </div>
                        <div class="d-flex justify-content-between text-secondary small">
                            <span>Tanggal Aktif</span>
                            <span class="text-dark">@FormatDate(Model.TanggalAktif)</span>
                        </div>
                        <div class="d-flex justify-content-between text-secondary small">
                            <span>Terakhir Nonaktif</span>
                            <span class="text-dark">@FormatDate(lastNonaktifDate)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg rounded-4 mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Data Personal</h6>
                    <span class="badge text-bg-light">Identitas</span>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="text-secondary small">Nama Alias</div>
                            <div class="fw-semibold">@Show(Model.NamaAlias)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Warga Negara</div>
                            <div class="fw-semibold">@Show(Model.WargaNegara)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">No KTP</div>
                            <div class="fw-semibold">@Show(Model.NoKtp)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">No KK</div>
                            <div class="fw-semibold">@Show(Model.NoKk)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Nama Ibu</div>
                            <div class="fw-semibold">@Show(Model.NamaIbu)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Nama Ayah</div>
                            <div class="fw-semibold">@Show(Model.NamaAyah)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Jenis Kelamin</div>
                            <div class="fw-semibold">@Show(Model.JenisKelamin)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Tempat, Tanggal Lahir</div>
                            <div class="fw-semibold">@Show(Model.TempatLahir) - @FormatDate(Model.TanggalLahir)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">ID Agama</div>
                            <div class="fw-semibold">@ShowInt(Model.IdAgama)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Status Nikah</div>
                            <div class="fw-semibold">@Show(Model.StatusNikah) (ID: @ShowInt(Model.IdStatusNikah))</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">No NPWP</div>
                            <div class="fw-semibold">@Show(Model.NoNpwp)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">No BPJS TK</div>
                            <div class="fw-semibold">@Show(Model.NoBpjsTk)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">No BPJS Kesehatan</div>
                            <div class="fw-semibold">@Show(Model.NoBpjsKes)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">No BPJS Pensiun</div>
                            <div class="fw-semibold">@Show(Model.NoBpjsPensiun)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">ID Pendidikan</div>
                            <div class="fw-semibold">@ShowInt(Model.IdPendidikan)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Nama Sekolah</div>
                            <div class="fw-semibold">@Show(Model.NamaSekolah)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Fakultas</div>
                            <div class="fw-semibold">@Show(Model.Fakultas)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Jurusan</div>
                            <div class="fw-semibold">@Show(Model.Jurusan)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">File Pendukung</div>
                            <div class="fw-semibold">@Show(Model.FilePendukung)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4 mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Kontak & Alamat</h6>
                    <span class="badge text-bg-light">Domisili</span>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="text-secondary small">Email Pribadi</div>
                            <div class="fw-semibold">@Show(Model.EmailPribadi)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">Email Kantor</div>
                            <div class="fw-semibold">@Show(Model.EmailKantor)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">HP 1</div>
                            <div class="fw-semibold">@Show(Model.Phone)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">HP 2</div>
                            <div class="fw-semibold">@Show(Model.PhoneAlt)</div>
                        </div>
                        <div class="col-12">
                            <div class="text-secondary small">Alamat</div>
                            <div class="fw-semibold">@Show(Model.Alamat)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Provinsi</div>
                            <div class="fw-semibold">@Show(Model.Provinsi)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Kabupaten</div>
                            <div class="fw-semibold">@Show(Model.Kabupaten)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Kecamatan</div>
                            <div class="fw-semibold">@Show(Model.Kecamatan)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Desa</div>
                            <div class="fw-semibold">@Show(Model.Desa)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Kode Pos</div>
                            <div class="fw-semibold">@Show(Model.KodePos)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4 mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Kepegawaian</h6>
                    <span class="badge text-bg-light">Status Kerja</span>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="text-secondary small">No ACR</div>
                            <div class="fw-semibold">@Show(Model.NoAcr)</div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-secondary small">ID Karyawan Indexim</div>
                            <div class="fw-semibold">@Show(Model.IdKaryawanIndexim)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Grade</div>
                            <div class="fw-semibold">@Show(Model.Grade)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Klasifikasi</div>
                            <div class="fw-semibold">@Show(Model.Klasifikasi)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Golongan (Tipe)</div>
                            <div class="fw-semibold">@Show(Model.GolonganTipe)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Roster Kerja</div>
                            <div class="fw-semibold">@Show(Model.RosterKerja)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Point of Hire</div>
                            <div class="fw-semibold">@Show(Model.PointOfHire)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Lokasi Penerimaan</div>
                            <div class="fw-semibold">@Show(Model.LokasiPenerimaan)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Lokasi Kerja</div>
                            <div class="fw-semibold">@Show(Model.LokasiKerja)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Status Residence</div>
                            <div class="fw-semibold">@Show(Model.StatusResidence)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Residence</div>
                            <div class="fw-semibold">@ShowInt(Model.ResidenceId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID POH</div>
                            <div class="fw-semibold">@ShowInt(Model.PohId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Posisi</div>
                            <div class="fw-semibold">@ShowInt(Model.PosisiId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Grade</div>
                            <div class="fw-semibold">@ShowInt(Model.GradeId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Klasifikasi</div>
                            <div class="fw-semibold">@ShowInt(Model.KlasifikasiId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Roster</div>
                            <div class="fw-semibold">@ShowInt(Model.RosterId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Status Karyawan</div>
                            <div class="fw-semibold">@ShowInt(Model.StatusKaryawanId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Paybase</div>
                            <div class="fw-semibold">@ShowInt(Model.PaybaseId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Jenis Pajak</div>
                            <div class="fw-semibold">@ShowInt(Model.JenisPajakId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Lokasi Penerimaan</div>
                            <div class="fw-semibold">@ShowInt(Model.LokasiPenerimaanId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Lokasi Kerja</div>
                            <div class="fw-semibold">@ShowInt(Model.LokasiKerjaId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Perusahaan Induk</div>
                            <div class="fw-semibold">@ShowInt(Model.PerusahaanMId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Date of Hire</div>
                            <div class="fw-semibold">@FormatDate(Model.DateOfHire)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Tanggal Masuk</div>
                            <div class="fw-semibold">@FormatDate(Model.TanggalMasuk)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Tanggal Aktif</div>
                            <div class="fw-semibold">@FormatDate(Model.TanggalAktif)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Tanggal Nonaktif (Karyawan)</div>
                            <div class="fw-semibold">@FormatDate(Model.TanggalNonAktifKaryawan)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Tanggal Alasan Nonaktif</div>
                            <div class="fw-semibold">@FormatDate(Model.AlasanNonAktifKaryawan)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">ID Jenis Perjanjian</div>
                            <div class="fw-semibold">@ShowInt(Model.JenisPerjanjianId)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">No Perjanjian</div>
                            <div class="fw-semibold">@Show(Model.NoPerjanjian)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Tanggal Ijin Mulai</div>
                            <div class="fw-semibold">@FormatDate(Model.TanggalIjinMulai)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Tanggal Ijin Akhir</div>
                            <div class="fw-semibold">@FormatDate(Model.TanggalIjinAkhir)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Created</div>
                            <div class="fw-semibold">@FormatDate(Model.CreatedAt) - @Show(Model.CreatedBy)</div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-secondary small">Updated</div>
                            <div class="fw-semibold">@FormatDate(Model.UpdatedAt) - @Show(Model.UpdatedBy)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4 mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-0">Riwayat Penempatan</h6>
                        <div class="text-secondary small">Filter per periode untuk melihat perpindahan.</div>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <form class="d-flex align-items-center gap-2" method="get">
                            <input type="hidden" name="id" value="@Model.KaryawanId" />
                            <input type="date" class="form-control form-control-sm" name="from" value="@(filterFrom?.ToString("yyyy-MM-dd") ?? string.Empty)" />
                            <span class="text-secondary small">s.d.</span>
                            <input type="date" class="form-control form-control-sm" name="to" value="@(filterTo?.ToString("yyyy-MM-dd") ?? string.Empty)" />
                            <button class="btn btn-sm btn-outline-primary" type="submit">
                                Filter
                            </button>
                        </form>
                        <span class="badge text-bg-light">@penempatan.Count</span>
                    </div>
                </div>
                <div class="card-body">
                    @if (!penempatan.Any())
                    {
                        <div class="text-secondary">Belum ada riwayat penempatan.</div>
                    }
                    else
                    {
                        <div class="timeline">
                            @foreach (var item in penempatan)
                            {
                                <div class="timeline-item">
                                    <div class="timeline-dot"></div>
                                    <div class="timeline-card">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <span class="fw-semibold">@item.CompanyName</span>
                                            <div class="d-flex align-items-center gap-2">
                                                <span class="badge text-bg-light">@item.Status</span>
                                                <span class="badge bg-soft-teal text-teal">@FormatSumber(item.Sumber)</span>
                                            </div>
                                        </div>
                                        <div class="text-secondary small">
                                            @item.DepartmentName / @item.SectionName / @item.PositionName
                                        </div>
                                        <div class="text-secondary small mt-1">
                                            @FormatDate(item.TanggalMulai) - @FormatDate(item.TanggalSelesai)
                                        </div>
                                        @if (!string.IsNullOrWhiteSpace(item.Keterangan))
                                        {
                                            <div class="small text-dark mt-2">@item.Keterangan</div>
                                        }
                                        @if (!string.IsNullOrWhiteSpace(item.CreatedBy))
                                        {
                                            <div class="small text-secondary mt-2">Diinput oleh: @item.CreatedBy</div>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Dokumen</h6>
                    <span class="badge text-bg-light">@dokumen.Count</span>
                </div>
                <div class="card-body">
                    @if (!dokumen.Any())
                    {
                        <div class="text-secondary">Belum ada dokumen.</div>
                    }
                    else
                    {
                        <div class="row g-3">
                            @foreach (var file in dokumen)
                            {
                                <div class="col-md-6">
                                    <div class="doc-card">
                                        <div class="doc-icon">
                                            <i class="bi bi-paperclip"></i>
                                        </div>
                                        <div class="doc-body">
                                            <div class="fw-semibold">@file.NamaDokumen</div>
                                            <div class="text-secondary small">@file.CreatedAt.ToString("dd MMM yyyy")</div>
                                            @if (!string.IsNullOrWhiteSpace(file.CreatedBy))
                                            {
                                                <div class="text-secondary small">Oleh: @file.CreatedBy</div>
                                            }
                                            <a class="btn btn-sm btn-outline-primary mt-2" href="@file.FilePath" target="_blank">
                                                Buka Dokumen
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4 mt-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Audit Trail (Per Field)</h6>
                    <span class="badge text-bg-light">@auditTrail.Count</span>
                </div>
                <div class="card-body table-responsive">
                    @if (!auditTrail.Any())
                    {
                        <div class="text-secondary">Belum ada perubahan tercatat.</div>
                    }
                    else
                    {
                        <table class="table table-striped align-middle mb-0">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Old</th>
                                    <th>New</th>
                                    <th>Waktu</th>
                                    <th>Oleh</th>
                                    <th>Sumber</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in auditTrail)
                                {
                                    <tr>
                                        <td>@item.FieldName</td>
                                        <td>@(string.IsNullOrWhiteSpace(item.OldValue) ? "-" : item.OldValue)</td>
                                        <td>@(string.IsNullOrWhiteSpace(item.NewValue) ? "-" : item.NewValue)</td>
                                        <td>@item.ChangedAt.ToLocalTime().ToString("dd MMM yyyy HH:mm")</td>
                                        <td>@(string.IsNullOrWhiteSpace(item.ChangedBy) ? "-" : item.ChangedBy)</td>
                                        <td>@(string.IsNullOrWhiteSpace(item.Source) ? "-" : item.Source)</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4 mt-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Vaksinasi</h6>
                    <span class="badge text-bg-light">@vaksin.Count</span>
                </div>
                <div class="card-body">
                    @if (!vaksin.Any())
                    {
                        <div class="text-secondary">Belum ada data vaksin.</div>
                    }
                    else
                    {
                        <div class="row g-3">
                            @foreach (var item in vaksin)
                            {
                                <div class="col-md-6">
                                    <div class="doc-card">
                                        <div class="doc-icon">
                                            <i class="bi bi-syringe"></i>
                                        </div>
                                        <div class="doc-body">
                                            <div class="fw-semibold">@item.Jenis</div>
                                            <div class="text-secondary small">Dosis: @item.Dosis</div>
                                            <div class="text-secondary small">Tanggal: @FormatDate(item.Tanggal)</div>
                                            @if (!string.IsNullOrWhiteSpace(item.Keterangan))
                                            {
                                                <div class="text-secondary small">@item.Keterangan</div>
                                            }
                                            @if (!string.IsNullOrWhiteSpace(item.FilePath))
                                            {
                                                <a class="btn btn-sm btn-outline-primary mt-2" href="@item.FilePath" target="_blank">
                                                    Buka Dokumen
                                                </a>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4 mt-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Riwayat Pendidikan</h6>
                    <span class="badge text-bg-light">@pendidikan.Count</span>
                </div>
                <div class="card-body">
                    @if (!pendidikan.Any())
                    {
                        <div class="text-secondary">Belum ada data pendidikan.</div>
                    }
                    else
                    {
                        <div class="accordion" id="pendidikanAccordion">
                            @for (var i = 0; i < pendidikan.Count; i++)
                            {
                                var item = pendidikan[i];
                                var headingId = $"pendidikanHeading{i}";
                                var collapseId = $"pendidikanCollapse{i}";
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="@headingId">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@collapseId" aria-expanded="false" aria-controls="@collapseId">
                                            <div class="d-flex flex-column">
                                                <span class="fw-semibold">@(!string.IsNullOrWhiteSpace(item.NamaSekolah) ? item.NamaSekolah : "Nama sekolah belum diisi")</span>
                                                <span class="small text-secondary">ID Pendidikan: @(item.IdPendidikan?.ToString() ?? "-")</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="@collapseId" class="accordion-collapse collapse" aria-labelledby="@headingId" data-bs-parent="#pendidikanAccordion">
                                        <div class="accordion-body">
                                            <div class="row g-2">
                                                <div class="col-md-6">
                                                    <div class="text-secondary small">Fakultas</div>
                                                    <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(item.Fakultas) ? item.Fakultas : "-")</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="text-secondary small">Jurusan</div>
                                                    <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(item.Jurusan) ? item.Jurusan : "-")</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="text-secondary small">Diinput</div>
                                                    <div class="fw-semibold">@FormatDate(item.CreatedAt)</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="text-secondary small">Oleh</div>
                                                    <div class="fw-semibold">@(!string.IsNullOrWhiteSpace(item.CreatedBy) ? item.CreatedBy : "system")</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4 mt-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Riwayat Perubahan</h6>
                    <span class="badge text-bg-light">@auditTrail.Count</span>
                </div>
                <div class="card-body">
                    @if (!auditTrail.Any())
                    {
                        <div class="text-secondary">Belum ada perubahan tercatat.</div>
                    }
                    else
                    {
                        <div class="audit-list">
                            @foreach (var item in auditTrail)
                            {
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </div>
                                    <div class="audit-body">
                                        <div class="fw-semibold">@item.FieldName</div>
                                        <div class="text-secondary small">
                                            @(!string.IsNullOrWhiteSpace(item.OldValue) ? item.OldValue : "-")
                                            <i class="bi bi-arrow-right mx-2"></i>
                                            @(!string.IsNullOrWhiteSpace(item.NewValue) ? item.NewValue : "-")
                                        </div>
                                        <div class="text-secondary small mt-1">
                                            @item.ChangedAt.ToString("dd MMM yyyy HH:mm") Â· @(item.ChangedBy ?? "system")
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .karyawan-detail-header {
            background: linear-gradient(135deg, #064e3b 0%, #0ea5a5 100%);
            padding: 2rem 2.5rem 3.5rem;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 15px 35px rgba(6, 78, 59, 0.35);
            margin-bottom: -2rem;
            position: relative;
            z-index: 1;
        }

        .karyawan-body {
            position: relative;
            z-index: 2;
        }

        .karyawan-photo-lg {
            width: 140px;
            height: 140px;
            border-radius: 24px;
            object-fit: cover;
            border: 3px solid #fff;
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
        }

        .karyawan-photo-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #94a3b8;
            background: #f1f5f9;
        }

        .timeline {
            position: relative;
            padding-left: 1.5rem;
            border-left: 2px solid #e2e8f0;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .timeline-dot {
            position: absolute;
            left: -0.55rem;
            top: 0.45rem;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background: #0ea5a5;
            border: 2px solid #fff;
            box-shadow: 0 0 0 4px rgba(14, 165, 165, 0.15);
        }

        .timeline-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem 1.25rem;
        }

        .doc-card {
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
            background: #f8fafc;
        }

        .doc-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(14, 165, 165, 0.12);
            color: #0f766e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .bg-soft-teal { background-color: #ccfbf1; }
        .text-teal { color: #0f766e; }

        .audit-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .audit-item {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 1rem 1.25rem;
        }

        .audit-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: rgba(14, 165, 165, 0.12);
            color: #0f766e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
    </style>
}
