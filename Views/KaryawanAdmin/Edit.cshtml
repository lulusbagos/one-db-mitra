@model one_db_mitra.Models.Admin.KaryawanCreateViewModel
@{
    ViewData["Title"] = "Edit Data Karyawan";
}

<div class="ik-hero">
    <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between">
        <div>
            <div class="d-flex align-items-center gap-3 mb-3">
                <div class="ik-hero-icon">
                    <i class="bi bi-people"></i>
                </div>
                <div>
                    <div class="ik-hero-title">Edit Data Karyawan</div>
                    <div class="ik-hero-subtitle">Perbarui data personal, kepegawaian, dan dokumen pendukung.</div>
                </div>
            </div>
            <div class="d-flex gap-2 flex-wrap">
                <span id="badgeActiveState" class="badge bg-success">AKTIF</span>
                <span id="badgeNonaktifState" class="badge bg-danger d-none">NONAKTIF</span>
                <span id="badgeBlacklistState" class="badge bg-dark d-none">BLACKLIST</span>
            </div>
        </div>
        <div class="d-flex gap-2 mt-3 mt-lg-0">
            <a class="btn btn-outline-light" asp-action="Index">
                <i class="bi bi-arrow-left me-2"></i>Kembali
            </a>
        </div>
    </div>
</div>

<div class="ik-nav-wrapper">
    <div class="ik-nav-container" id="ikStepNav">
        <button class="ik-step-pill active" type="button" data-target="#stepPersonal">
            <i class="bi bi-person-badge"></i> 1. Data Personal
        </button>
        <button class="ik-step-pill" type="button" data-target="#stepKepegawaian">
            <i class="bi bi-briefcase"></i> 2. Kepegawaian
        </button>
        <button class="ik-step-pill" type="button" data-target="#stepTambahan">
            <i class="bi bi-person-lines-fill"></i> 3. Data Tambahan
        </button>
        <button class="ik-step-pill" type="button" data-target="#stepVaksin">
            <i class="bi bi-syringe"></i> 4. Vaksinasi
        </button>
        <button class="ik-step-pill" type="button" data-target="#stepPelanggaran">
            <i class="bi bi-exclamation-triangle"></i> 5. Pelanggaran
        </button>
        <button class="ik-step-pill" type="button" data-target="#stepLampiran">
            <i class="bi bi-paperclip"></i> 6. Lampiran
        </button>
    </div>
</div>

<div class="ik-content-wrapper">
    <form method="post" asp-action="Edit" asp-route-id="@Model.KaryawanId" class="ik-form" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="KaryawanId" />

        <div id="stepPersonal" class="ik-section-container">
            <div class="section-header">
                <h2 class="section-title">Data Personal</h2>
                <p class="text-secondary mb-0">Identitas dasar karyawan sesuai KTP.</p>
            </div>
            <div class="row g-4">
                <div class="col-xl-3 col-lg-4">
                    <div class="pas-foto-wrapper">
                        <label asp-for="FotoFile" class="form-label text-center w-100">Pas Foto</label>
                        <div class="pas-foto-container">
                            <img id="previewPasFoto" src="@(Model.CurrentPhotoUrl ?? string.Empty)" class="pas-foto-preview @(string.IsNullOrWhiteSpace(Model.CurrentPhotoUrl) ? "d-none" : "")" alt="Foto" />
                            <div class="pas-foto-placeholder @(string.IsNullOrWhiteSpace(Model.CurrentPhotoUrl) ? "" : "d-none")" id="placeholderPasFoto">
                                <div class="pas-foto-icon"><i class="bi bi-camera"></i></div>
                                <div class="fw-semibold">Klik untuk upload</div>
                                <div class="text-secondary small">JPG / PNG</div>
                            </div>
                            <input asp-for="FotoFile" class="upload-input-hidden" type="file" accept=".jpg,.jpeg,.png" id="fotoInput" />
                        </div>
                    </div>
                </div>
                <div class="col-xl-9 col-lg-8">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label asp-for="WargaNegara" class="form-label ik-required"></label>
                            <select asp-for="WargaNegara" class="form-select" id="wargaNegaraSelect">
                                <option value="WNI">WNI</option>
                                <option value="WNA">WNA</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NoKtp" class="form-label"></label>
                            <input asp-for="NoKtp" class="form-control" placeholder="No KTP / Paspor" id="noKtpInput" />
                            <span class="text-danger" asp-validation-for="NoKtp"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NoNik" class="form-label ik-required"></label>
                            <input asp-for="NoNik" class="form-control" placeholder="NIK" readonly />
                            <span class="text-danger" asp-validation-for="NoNik"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="IdKaryawan" class="form-label"></label>
                            <input asp-for="IdKaryawan" class="form-control" placeholder="Auto generate: IC-XXXXXXX" readonly />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NoKk" class="form-label"></label>
                            <input asp-for="NoKk" class="form-control" placeholder="No KK" />
                            <span class="text-danger" asp-validation-for="NoKk"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NamaLengkap" class="form-label ik-required"></label>
                            <input asp-for="NamaLengkap" class="form-control" placeholder="Nama lengkap" />
                            <span class="text-danger" asp-validation-for="NamaLengkap"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NamaAlias" class="form-label"></label>
                            <input asp-for="NamaAlias" class="form-control" placeholder="Nama panggilan" />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NamaIbu" class="form-label"></label>
                            <input asp-for="NamaIbu" class="form-control" placeholder="Nama ibu kandung" />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NamaAyah" class="form-label"></label>
                            <input asp-for="NamaAyah" class="form-control" placeholder="Nama ayah kandung" />
                        </div>
                        <div class="col-md-3">
                            <label asp-for="JenisKelamin" class="form-label"></label>
                            <select asp-for="JenisKelamin" class="form-select">
                                <option value="">--</option>
                                <option value="Laki-laki">Laki-laki</option>
                                <option value="Perempuan">Perempuan</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label asp-for="TanggalLahir" class="form-label"></label>
                            <input asp-for="TanggalLahir" class="form-control" type="date" />
                        </div>
                        <div class="col-md-6">
                            <label asp-for="TempatLahir" class="form-label"></label>
                            <input asp-for="TempatLahir" class="form-control" placeholder="Tempat lahir" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="IdAgama" class="form-label"></label>
                            <input asp-for="IdAgama" class="form-control" type="number" min="0" placeholder="ID agama" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="IdStatusNikah" class="form-label"></label>
                            <input asp-for="IdStatusNikah" class="form-control" type="number" min="0" placeholder="ID status nikah" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="StatusNikah" class="form-label"></label>
                            <input asp-for="StatusNikah" class="form-control" placeholder="Status nikah" />
                        </div>
                        <div class="col-12 pt-2">
                            <h6 class="mb-1">Alamat Domisili</h6>
                            <p class="text-secondary small mb-0">Pilih wilayah sesuai provinsi, kabupaten, kecamatan, desa.</p>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Provinsi" class="form-label"></label>
                            <select asp-for="Provinsi" class="form-select" id="provinsiSelect" data-selected="@Model.Provinsi">
                                <option value="">-- Pilih Provinsi --</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Kabupaten" class="form-label"></label>
                            <select asp-for="Kabupaten" class="form-select" id="kabupatenSelect" data-selected="@Model.Kabupaten">
                                <option value="">-- Pilih Kabupaten --</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Kecamatan" class="form-label"></label>
                            <select asp-for="Kecamatan" class="form-select" id="kecamatanSelect" data-selected="@Model.Kecamatan">
                                <option value="">-- Pilih Kecamatan --</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Desa" class="form-label"></label>
                            <select asp-for="Desa" class="form-select" id="desaSelect" data-selected="@Model.Desa">
                                <option value="">-- Pilih Desa --</option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <label asp-for="Alamat" class="form-label"></label>
                            <textarea asp-for="Alamat" class="form-control" rows="2" placeholder="Alamat lengkap"></textarea>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="KodePos" class="form-label"></label>
                            <input asp-for="KodePos" class="form-control" placeholder="Kode pos" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="stepKepegawaian" class="ik-section-container d-none">
            <div class="section-header">
                <h2 class="section-title">Kepegawaian</h2>
                <p class="text-secondary mb-0">Struktur organisasi dan penempatan karyawan.</p>
            </div>
            <div class="row g-3">
                <div class="col-md-4">
                    <label asp-for="CompanyId" class="form-label ik-required"></label>
                    <select asp-for="CompanyId" class="form-select js-company-select" asp-items="Model.CompanyOptions" id="companySelect" data-placeholder="Pilih perusahaan">
                        <option value="">--</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="DepartmentId" class="form-label"></label>
                    <select asp-for="DepartmentId" class="form-select" id="departmentSelect" data-selected="@Model.DepartmentId">
                        <option value="">--</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="SectionId" class="form-label"></label>
                    <select asp-for="SectionId" class="form-select" id="sectionSelect" data-selected="@Model.SectionId">
                        <option value="">--</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="PositionId" class="form-label"></label>
                    <select asp-for="PositionId" class="form-select" id="positionSelect" data-selected="@Model.PositionId">
                        <option value="">--</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="NoAcr" class="form-label"></label>
                    <input asp-for="NoAcr" class="form-control" placeholder="No ACR" />
                </div>
                <div class="col-md-4">
                    <label asp-for="Grade" class="form-label"></label>
                    <select asp-for="Grade" class="form-select" id="gradeSelect" data-selected="@Model.Grade">
                        <option value="">-- Pilih --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="Klasifikasi" class="form-label"></label>
                    <select asp-for="Klasifikasi" class="form-select" id="klasifikasiSelect" data-selected="@Model.Klasifikasi">
                        <option value="">-- Pilih --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="GolonganTipe" class="form-label"></label>
                    <select asp-for="GolonganTipe" class="form-select" id="golonganSelect" data-selected="@Model.GolonganTipe">
                        <option value="">-- Pilih --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="RosterKerja" class="form-label"></label>
                    <select asp-for="RosterKerja" class="form-select" id="rosterSelect" data-selected="@Model.RosterKerja">
                        <option value="">-- Pilih --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="PointOfHire" class="form-label"></label>
                    <select asp-for="PointOfHire" class="form-select" id="pohSelect" data-selected="@Model.PointOfHire">
                        <option value="">-- Pilih POH --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="LokasiPenerimaan" class="form-label"></label>
                    <select asp-for="LokasiPenerimaan" class="form-select" id="lokasiPenerimaanSelect" data-selected="@Model.LokasiPenerimaan">
                        <option value="">-- Pilih --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="LokasiKerja" class="form-label"></label>
                    <select asp-for="LokasiKerja" class="form-select" id="lokasiKerjaSelect" data-selected="@Model.LokasiKerja">
                        <option value="">-- Pilih --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="StatusResidence" class="form-label"></label>
                    <select asp-for="StatusResidence" class="form-select" id="statusResidenceSelect" data-selected="@Model.StatusResidence">
                        <option value="">-- Pilih --</option>
                    </select>
                </div>
                <div class="col-12 pt-2">
                    <h6 class="mb-1">Administrasi & ID Master</h6>
                    <p class="text-secondary small mb-0">Opsional. Isi jika ada ID master dari sistem lain.</p>
                </div>
                <div class="col-md-4">
                    <label asp-for="PosisiId" class="form-label"></label>
                    <input asp-for="PosisiId" class="form-control" type="number" min="0" placeholder="ID posisi" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdPoh" class="form-label"></label>
                    <input asp-for="IdPoh" class="form-control" type="number" min="0" placeholder="ID POH" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdGrade" class="form-label"></label>
                    <input asp-for="IdGrade" class="form-control" type="number" min="0" placeholder="ID grade" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdKlasifikasi" class="form-label"></label>
                    <input asp-for="IdKlasifikasi" class="form-control" type="number" min="0" placeholder="ID klasifikasi" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdRoster" class="form-label"></label>
                    <input asp-for="IdRoster" class="form-control" type="number" min="0" placeholder="ID roster" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdStatusKaryawan" class="form-label"></label>
                    <input asp-for="IdStatusKaryawan" class="form-control" type="number" min="0" placeholder="ID status karyawan" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdPaybase" class="form-label"></label>
                    <input asp-for="IdPaybase" class="form-control" type="number" min="0" placeholder="ID paybase" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdJenisPajak" class="form-label"></label>
                    <input asp-for="IdJenisPajak" class="form-control" type="number" min="0" placeholder="ID jenis pajak" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdLokasiPenerimaan" class="form-label"></label>
                    <input asp-for="IdLokasiPenerimaan" class="form-control" type="number" min="0" placeholder="ID lokasi penerimaan" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdLokasiKerja" class="form-label"></label>
                    <input asp-for="IdLokasiKerja" class="form-control" type="number" min="0" placeholder="ID lokasi kerja" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdResidence" class="form-label"></label>
                    <input asp-for="IdResidence" class="form-control" type="number" min="0" placeholder="ID residence" />
                </div>
                <div class="col-md-4">
                    <label asp-for="PerusahaanMId" class="form-label"></label>
                    <input asp-for="PerusahaanMId" class="form-control" type="number" min="0" placeholder="ID perusahaan induk" />
                </div>
                <div class="col-md-4">
                    <label asp-for="IdJenisPerjanjian" class="form-label"></label>
                    <input asp-for="IdJenisPerjanjian" class="form-control" type="number" min="0" placeholder="ID jenis perjanjian" />
                </div>
                <div class="col-md-4">
                    <label asp-for="NoPerjanjian" class="form-label"></label>
                    <input asp-for="NoPerjanjian" class="form-control" placeholder="No perjanjian" />
                </div>
                <div class="col-md-4">
                    <label asp-for="TanggalIjinMulai" class="form-label"></label>
                    <input asp-for="TanggalIjinMulai" class="form-control" type="date" />
                </div>
                <div class="col-md-4">
                    <label asp-for="TanggalIjinAkhir" class="form-label"></label>
                    <input asp-for="TanggalIjinAkhir" class="form-control" type="date" />
                </div>
                <div class="col-md-4">
                    <label asp-for="TanggalNonAktifKaryawan" class="form-label"></label>
                    <input asp-for="TanggalNonAktifKaryawan" class="form-control" type="date" />
                </div>
                <div class="col-md-4">
                    <label asp-for="AlasanNonAktifKaryawan" class="form-label"></label>
                    <input asp-for="AlasanNonAktifKaryawan" class="form-control" type="date" />
                </div>
                <div class="col-md-4">
                    <label asp-for="DateOfHire" class="form-label"></label>
                    <input asp-for="DateOfHire" class="form-control" type="date" />
                </div>
                <div class="col-md-4">
                    <label asp-for="TanggalMasuk" class="form-label"></label>
                    <input asp-for="TanggalMasuk" class="form-control" type="date" />
                </div>
                <div class="col-md-4">
                    <label asp-for="TanggalAktif" class="form-label"></label>
                    <input asp-for="TanggalAktif" class="form-control" type="date" />
                </div>
                <div class="col-md-4 d-flex align-items-center">
                    <div class="form-check mt-4">
                        <input asp-for="IsActive" class="form-check-input" id="isActiveToggle" />
                        <label asp-for="IsActive" class="form-check-label"></label>
                    </div>
                </div>
            </div>
        </div>

        <div id="stepTambahan" class="ik-section-container d-none">
            <div class="section-header">
                <h2 class="section-title">Data Tambahan</h2>
                <p class="text-secondary mb-0">Kontak dan informasi tambahan.</p>
            </div>
            <div class="row g-3">
                <div class="col-md-6">
                    <label asp-for="EmailPribadi" class="form-label"></label>
                    <input asp-for="EmailPribadi" class="form-control" placeholder="nama@gmail.com" />
                </div>
                <div class="col-md-6">
                    <label asp-for="EmailKantor" class="form-label"></label>
                    <input asp-for="EmailKantor" class="form-control" placeholder="nama@company.com" />
                </div>
                <div class="col-md-6">
                    <label asp-for="Hp1" class="form-label"></label>
                    <input asp-for="Hp1" class="form-control" placeholder="08xxxx" />
                </div>
                <div class="col-md-6">
                    <label asp-for="Hp2" class="form-label"></label>
                    <input asp-for="Hp2" class="form-control" placeholder="08xxxx" />
                </div>
                <div class="col-md-6">
                    <label asp-for="NoNpwp" class="form-label"></label>
                    <input asp-for="NoNpwp" class="form-control" placeholder="No NPWP" />
                </div>
                <div class="col-md-6">
                    <label asp-for="NoBpjsTk" class="form-label"></label>
                    <input asp-for="NoBpjsTk" class="form-control" placeholder="No BPJS TK" />
                </div>
                <div class="col-md-6">
                    <label asp-for="NoBpjsKes" class="form-label"></label>
                    <input asp-for="NoBpjsKes" class="form-control" placeholder="No BPJS Kesehatan" />
                </div>
                <div class="col-md-6">
                    <label asp-for="NoBpjsPensiun" class="form-label"></label>
                    <input asp-for="NoBpjsPensiun" class="form-control" placeholder="No BPJS Pensiun" />
                </div>
                <div class="col-12 pt-2">
                    <h6 class="mb-1">Pendidikan Terakhir</h6>
                    <p class="text-secondary small mb-0">Ringkasan pendidikan utama di data personal.</p>
                </div>
                <div class="col-md-4">
                    <label asp-for="IdPendidikan" class="form-label"></label>
                    <input asp-for="IdPendidikan" class="form-control" type="number" min="0" placeholder="ID pendidikan" />
                </div>
                <div class="col-md-4">
                    <label asp-for="NamaSekolah" class="form-label"></label>
                    <input asp-for="NamaSekolah" class="form-control" placeholder="Nama sekolah" />
                </div>
                <div class="col-md-4">
                    <label asp-for="Fakultas" class="form-label"></label>
                    <input asp-for="Fakultas" class="form-control" placeholder="Fakultas" />
                </div>
                <div class="col-md-4">
                    <label asp-for="Jurusan" class="form-label"></label>
                    <input asp-for="Jurusan" class="form-control" placeholder="Jurusan" />
                </div>
                <div class="col-md-8">
                    <label asp-for="FilePendukung" class="form-label"></label>
                    <input asp-for="FilePendukung" class="form-control" placeholder="Nama file pendukung" />
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center justify-content-between mt-2">
                        <div>
                            <h6 class="mb-0">Riwayat Pendidikan</h6>
                            <div class="text-secondary small">Tambahkan lebih dari satu pendidikan jika ada.</div>
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="btnAddPendidikan">
                            <i class="bi bi-plus-lg me-1"></i>Tambah Pendidikan
                        </button>
                    </div>
                </div>
                <div class="col-12">
                    <div id="pendidikanList" class="d-flex flex-column gap-3" data-index="@Model.PendidikanItems.Count">
                        @for (var i = 0; i < Model.PendidikanItems.Count; i++)
                        {
                            <div class="dynamic-item">
                                <div class="row g-3 align-items-end">
                                    <div class="col-md-2">
                                        <label class="form-label">ID Pendidikan</label>
                                        <input class="form-control" type="number" min="0" name="PendidikanItems[@i].IdPendidikan" value="@Model.PendidikanItems[i].IdPendidikan" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Nama Sekolah</label>
                                        <input class="form-control" name="PendidikanItems[@i].NamaSekolah" value="@Model.PendidikanItems[i].NamaSekolah" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Fakultas</label>
                                        <input class="form-control" name="PendidikanItems[@i].Fakultas" value="@Model.PendidikanItems[i].Fakultas" />
                                    </div>
                                    <div class="col-md-3 text-end">
                                        <label class="form-label">Jurusan</label>
                                        <input class="form-control" name="PendidikanItems[@i].Jurusan" value="@Model.PendidikanItems[i].Jurusan" />
                                    </div>
                                    <div class="col-12 text-end">
                                        <button type="button" class="btn btn-outline-danger btn-sm pendidikan-remove">
                                            <i class="bi bi-trash"></i> Hapus
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div id="pendidikanEmpty" class="text-secondary small @(Model.PendidikanItems.Count > 0 ? "d-none" : "")">Belum ada data pendidikan.</div>
                </div>
            </div>
        </div>

        <div id="stepLampiran" class="ik-section-container d-none">
            <div class="section-header">
                <h2 class="section-title">Lampiran</h2>
                <p class="text-secondary mb-0">Upload dokumen pendukung karyawan.</p>
            </div>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="upload-card">
                        <div class="upload-icon"><i class="bi bi-file-earmark-arrow-up"></i></div>
                        <div class="upload-title">Dokumen Pendukung</div>
                        <div class="text-secondary small mb-2">Bisa lebih dari satu file.</div>
                        <input asp-for="DokumenFiles" class="upload-input-hidden" type="file" multiple id="dokumenInput" />
                        <div class="file-status-badge" id="dokumenBadge"><i class="bi bi-check-lg"></i></div>
                        <div class="small text-secondary" id="dokumenCount">Belum ada file.</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="stepVaksin" class="ik-section-container d-none">
            <div class="section-header">
                <h2 class="section-title">Vaksinasi</h2>
                <p class="text-secondary mb-0">Catat riwayat vaksin karyawan.</p>
            </div>
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h6 class="mb-0">Daftar Vaksin</h6>
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnAddVaksin">
                    <i class="bi bi-plus-lg me-1"></i>Tambah Vaksin
                </button>
            </div>
            <div id="vaksinList" class="d-flex flex-column gap-3"></div>
            <div id="vaksinEmpty" class="text-secondary small">Belum ada data vaksin.</div>
        </div>

        <div id="stepPelanggaran" class="ik-section-container d-none">
            <div class="section-header">
                <h2 class="section-title">Pelanggaran & Status Khusus</h2>
                <p class="text-secondary mb-0">Catat pelanggaran safety/HR, status nonaktif, atau blacklist.</p>
            </div>
            <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
                <div class="small text-secondary">Ringkasan Pelanggaran:</div>
                <div class="d-flex align-items-center gap-2">
                    <span class="pelanggaran-pill text-danger">
                        <span id="safetyStars"></span>
                        <span class="small ms-1" id="safetyCount">0 Safety</span>
                    </span>
                    <span class="pelanggaran-pill text-primary">
                        <span id="hrStars"></span>
                        <span class="small ms-1" id="hrCount">0 HR</span>
                    </span>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input asp-for="NonaktifEnabled" class="form-check-input" id="nonaktifToggle" />
                        <label class="form-check-label" for="nonaktifToggle">Nonaktifkan karyawan</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input asp-for="BlacklistEnabled" class="form-check-input" id="blacklistToggle" />
                        <label class="form-check-label" for="blacklistToggle">Blacklist</label>
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-4" id="nonaktifFields">
                <div class="col-md-4">
                    <label asp-for="NonaktifKategori" class="form-label"></label>
                    <input asp-for="NonaktifKategori" class="form-control" placeholder="Resign / Sanksi / Kontrak Habis" />
                </div>
                <div class="col-md-4">
                    <label asp-for="NonaktifTanggal" class="form-label"></label>
                    <input asp-for="NonaktifTanggal" class="form-control" type="date" />
                </div>
                <div class="col-md-4">
                    <label asp-for="NonaktifAlasan" class="form-label"></label>
                    <input asp-for="NonaktifAlasan" class="form-control" placeholder="Alasan nonaktif" />
                </div>
                <div class="col-12">
                    <label asp-for="NonaktifKeterangan" class="form-label"></label>
                    <textarea asp-for="NonaktifKeterangan" class="form-control" rows="3" placeholder="Keterangan tambahan"></textarea>
                </div>
            </div>

            <div class="row g-3 mb-4" id="blacklistFields">
                <div class="col-md-6">
                    <label asp-for="BlacklistTanggal" class="form-label"></label>
                    <input asp-for="BlacklistTanggal" class="form-control" type="date" />
                </div>
                <div class="col-md-6">
                    <label asp-for="BlacklistAlasan" class="form-label"></label>
                    <input asp-for="BlacklistAlasan" class="form-control" placeholder="Alasan blacklist" />
                </div>
            </div>

            <div class="d-flex align-items-center justify-content-between mb-3">
                <h6 class="mb-0">Daftar Pelanggaran</h6>
                <button type="button" class="btn btn-outline-primary btn-sm" id="btnAddPelanggaran">
                    <i class="bi bi-plus-lg me-1"></i>Tambah Pelanggaran
                </button>
            </div>
            <div id="pelanggaranList" class="d-flex flex-column gap-3"></div>
            <div id="pelanggaranEmpty" class="text-secondary small">Belum ada pelanggaran.</div>
        </div>

        <div class="ik-sticky-actions">
            <div class="text-secondary small">Pastikan data wajib terisi sebelum menyimpan.</div>
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">
                    <i class="bi bi-save me-2"></i>Simpan Perubahan
                </button>
            </div>
        </div>
    </form>
</div>

@section Styles {
    <style>
        :root {
            --ik-primary: #0f766e;
            --ik-accent: #0ea5e9;
            --ik-shadow: 0 18px 45px rgba(15, 23, 42, 0.2);
        }

        @@keyframes fadeInUp {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @@keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .ik-hero {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 2.5rem 2.5rem 4rem;
            margin-bottom: -2rem;
            color: white;
            border-radius: 0 0 26px 26px;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.35);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease;
        }
        .ik-hero::before {
            content: "";
            position: absolute;
            width: 520px;
            height: 520px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(14, 165, 233, 0.18) 0%, transparent 70%);
            top: -200px;
            right: -160px;
            pointer-events: none;
        }
        .ik-hero::after {
            content: "";
            position: absolute;
            width: 420px;
            height: 420px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.16) 0%, transparent 70%);
            bottom: -240px;
            left: -180px;
            pointer-events: none;
        }
        .ik-hero > .d-flex {
            position: relative;
            z-index: 1;
        }
        .ik-hero-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: #fff;
            color: #0f766e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
        }
        .ik-hero-title { font-weight: 800; font-size: 1.4rem; }
        .ik-hero-subtitle { color: rgba(255,255,255,0.6); }
        .ik-nav-wrapper { padding: 0 2.5rem; }
        .ik-nav-container {
            background: rgba(255,255,255,0.95);
            border-radius: 18px;
            padding: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
            margin-top: -1.5rem;
            position: relative;
            z-index: 2;
            animation: slideInUp 0.6s ease;
        }
        .ik-step-pill {
            border: 1px solid transparent;
            background: transparent;
            padding: 0.6rem 1.2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.85rem;
            color: #475569;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease, color 0.2s ease, background 0.2s ease;
        }
        .ik-step-pill:hover { transform: translateY(-2px); }
        .ik-step-pill.active {
            background: #0f766e;
            color: #fff;
            box-shadow: 0 8px 20px rgba(15, 118, 110, 0.25);
        }
        .ik-content-wrapper { padding: 0 2.5rem 6rem; }
        .ik-section-container {
            background: #fff;
            border-radius: 18px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
            border: 1px solid #e2e8f0;
            animation: fadeInUp 0.6s ease;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .ik-section-container.fade-out { opacity: 0; transform: translateY(12px); }
        .ik-section-container.fade-in { opacity: 1; transform: translateY(0); }
        .section-header {
            border-left: 6px solid #0f766e;
            padding-left: 1.2rem;
            margin-bottom: 2rem;
        }
        .section-title { font-weight: 800; margin-bottom: 0.35rem; }
        .ik-required::after { content: "*"; color: #ef4444; margin-left: 4px; }
        .pas-foto-wrapper {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);
            text-align: center;
        }
        .pas-foto-container {
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            min-height: 260px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: #f8fafc;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .pas-foto-container:hover {
            border-color: var(--ik-accent);
            box-shadow: var(--ik-shadow);
        }
        .pas-foto-preview {
            width: 100%;
            height: 260px;
            object-fit: cover;
        }
        .pas-foto-placeholder { padding: 1rem; }
        .pas-foto-icon {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            background: #fff;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0f766e;
            font-size: 1.6rem;
            box-shadow: 0 6px 18px rgba(15, 23, 42, 0.12);
        }
        .upload-card {
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 2rem;
            position: relative;
            text-align: center;
            background: #fff;
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .upload-card:hover { transform: translateY(-4px); box-shadow: var(--ik-shadow); }
        .dynamic-item {
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 1.5rem;
            background: #fff;
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.06);
            animation: fadeInUp 0.4s ease;
        }
        .pelanggaran-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.7rem;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.04);
            font-weight: 600;
        }
        .pelanggaran-pill .bi-star-fill {
            font-size: 0.9rem;
        }
        .upload-icon { font-size: 2.5rem; color: #cbd5e1; margin-bottom: 1rem; }
        .upload-title { font-weight: 700; margin-bottom: 0.5rem; }
        .upload-input-hidden {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }
        .file-status-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #10b981;
            color: #fff;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .ik-form .form-label {
            font-weight: 600;
            color: #1e293b;
            letter-spacing: 0.01em;
        }
        .ik-form .form-control,
        .ik-form .form-select,
        .ik-form textarea.form-control {
            border-radius: 14px;
            border: 1px solid #e2e8f0;
            background: #f8fafc;
            padding: 0.7rem 0.9rem;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }
        .ik-form .form-control:focus,
        .ik-form .form-select:focus,
        .ik-form textarea.form-control:focus {
            background: #ffffff;
            border-color: #14b8a6;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.18);
        }
        .ik-form .form-control::placeholder {
            color: #94a3b8;
        }
        .ik-form .form-select {
            background-image: linear-gradient(45deg, transparent 50%, #64748b 50%),
                              linear-gradient(135deg, #64748b 50%, transparent 50%);
            background-position: calc(100% - 18px) calc(1rem + 2px), calc(100% - 12px) calc(1rem + 2px);
            background-size: 6px 6px, 6px 6px;
            background-repeat: no-repeat;
        }
        .ik-section-container .form-text,
        .ik-section-container .text-secondary.small {
            color: #64748b !important;
        }
        .ik-sticky-actions {
            position: sticky;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            padding: 1rem 1.5rem;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }
    </style>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const navButtons = document.querySelectorAll('#ikStepNav .ik-step-pill');
            const sections = document.querySelectorAll('.ik-section-container');

            navButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    navButtons.forEach(b => b.classList.remove('active'));
                    sections.forEach(sec => {
                        sec.classList.add('fade-out');
                        setTimeout(() => sec.classList.add('d-none'), 150);
                    });
                    btn.classList.add('active');
                    const target = btn.getAttribute('data-target');
                    const targetEl = document.querySelector(target);
                    if (targetEl) {
                        setTimeout(() => {
                            targetEl.classList.remove('d-none');
                            targetEl.classList.remove('fade-out');
                            targetEl.classList.add('fade-in');
                        }, 160);
                    }
                    window.scrollTo({ top: document.getElementById('ikStepNav').offsetTop - 80, behavior: 'smooth' });
                });
            });

            const company = document.getElementById('companySelect');
            const department = document.getElementById('departmentSelect');
            const section = document.getElementById('sectionSelect');
            const position = document.getElementById('positionSelect');

            function resetSelect(target) {
                target.innerHTML = '<option value="">--</option>';
            }

            async function loadDepartments(companyId) {
                resetSelect(department);
                resetSelect(section);
                resetSelect(position);
                if (!companyId) return;
                const response = await fetch(`/KaryawanAdmin/DepartmentsByCompany?companyId=${companyId}`);
                const data = await response.json();
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.name;
                    department.appendChild(option);
                });

                const selected = department?.dataset.selected;
                if (selected) {
                    department.value = selected;
                    if (department.value) {
                        await loadSections(department.value);
                    }
                }
            }

            async function loadSections(deptId) {
                resetSelect(section);
                resetSelect(position);
                if (!deptId) return;
                const response = await fetch(`/KaryawanAdmin/SectionsByDepartment?departmentId=${deptId}`);
                const data = await response.json();
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.name;
                    section.appendChild(option);
                });

                const selected = section?.dataset.selected;
                if (selected) {
                    section.value = selected;
                    if (section.value) {
                        await loadPositions(section.value);
                    }
                }
            }

            async function loadPositions(sectionId) {
                resetSelect(position);
                if (!sectionId) return;
                const response = await fetch(`/KaryawanAdmin/PositionsBySection?sectionId=${sectionId}`);
                const data = await response.json();
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.name;
                    position.appendChild(option);
                });

                const selected = position?.dataset.selected;
                if (selected) {
                    position.value = selected;
                }
            }

            company?.addEventListener('change', (e) => loadDepartments(e.target.value));
            department?.addEventListener('change', (e) => loadSections(e.target.value));
            section?.addEventListener('change', (e) => loadPositions(e.target.value));
            if (company?.value) {
                loadDepartments(company.value);
            }

            const fotoInput = document.getElementById('fotoInput');
            const fotoPreview = document.getElementById('previewPasFoto');
            const fotoPlaceholder = document.getElementById('placeholderPasFoto');
            if (fotoInput) {
                fotoInput.addEventListener('change', function () {
                    const file = fotoInput.files && fotoInput.files[0];
                    if (!file) {
                        fotoPreview.classList.add('d-none');
                        fotoPlaceholder.classList.remove('d-none');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        fotoPreview.src = e.target.result;
                        fotoPreview.classList.remove('d-none');
                        fotoPlaceholder.classList.add('d-none');
                    };
                    reader.readAsDataURL(file);
                });
            }

            const wargaSelect = document.getElementById('wargaNegaraSelect');
            const ktpInput = document.getElementById('noKtpInput');
            function applyKtpRule() {
                if (!wargaSelect || !ktpInput) return;
                const warga = (wargaSelect.value || 'WNI').toUpperCase();
                if (warga === 'WNI') {
                    ktpInput.setAttribute('maxlength', '16');
                    ktpInput.setAttribute('pattern', '\\\\d{16}');
                    ktpInput.placeholder = '16 digit angka';
                } else {
                    ktpInput.removeAttribute('maxlength');
                    ktpInput.setAttribute('pattern', '[A-Za-z0-9]+');
                    ktpInput.placeholder = 'No Paspor (huruf/angka)';
                }
            }
            wargaSelect?.addEventListener('change', applyKtpRule);
            applyKtpRule();

            const nonaktifToggle = document.getElementById('nonaktifToggle');
            const blacklistToggle = document.getElementById('blacklistToggle');
            const nonaktifFields = document.getElementById('nonaktifFields');
            const blacklistFields = document.getElementById('blacklistFields');
            const badgeNonaktif = document.getElementById('badgeNonaktifState');
            const badgeBlacklist = document.getElementById('badgeBlacklistState');
            const badgeActive = document.getElementById('badgeActiveState');
            const isActiveToggle = document.getElementById('isActiveToggle');

            function syncStatusBadges() {
                const nonaktifOn = nonaktifToggle?.checked;
                const blacklistOn = blacklistToggle?.checked;
                badgeNonaktif?.classList.toggle('d-none', !nonaktifOn);
                badgeBlacklist?.classList.toggle('d-none', !blacklistOn);
                if (badgeActive) {
                    badgeActive.classList.toggle('d-none', nonaktifOn || blacklistOn);
                }
                if (isActiveToggle && (nonaktifOn || blacklistOn)) {
                    isActiveToggle.checked = false;
                }
            }

            if (nonaktifToggle) {
                nonaktifToggle.addEventListener('change', () => {
                    nonaktifFields?.classList.toggle('d-none', !nonaktifToggle.checked);
                    syncStatusBadges();
                });
                nonaktifFields?.classList.toggle('d-none', !nonaktifToggle.checked);
            }

            if (blacklistToggle) {
                blacklistToggle.addEventListener('change', () => {
                    blacklistFields?.classList.toggle('d-none', !blacklistToggle.checked);
                    syncStatusBadges();
                });
                blacklistFields?.classList.toggle('d-none', !blacklistToggle.checked);
            }

            syncStatusBadges();

            const pelList = document.getElementById('pelanggaranList');
            const pelEmpty = document.getElementById('pelanggaranEmpty');
            const btnAddPel = document.getElementById('btnAddPelanggaran');
            let pelIndex = 0;
            const safetyStars = document.getElementById('safetyStars');
            const hrStars = document.getElementById('hrStars');
            const safetyCountEl = document.getElementById('safetyCount');
            const hrCountEl = document.getElementById('hrCount');

            function updatePelanggaranStars() {
                const jenisList = Array.from(pelList.querySelectorAll('.pel-jenis'))
                    .map(el => (el.value || '').toLowerCase());
                const safetyCount = jenisList.filter(j => j === 'safety').length;
                const hrCount = jenisList.filter(j => j === 'hr').length;

                if (safetyStars) {
                    safetyStars.innerHTML = '';
                    for (let i = 0; i < safetyCount; i += 1) {
                        const star = document.createElement('i');
                        star.className = 'bi bi-star-fill';
                        safetyStars.appendChild(star);
                    }
                }
                if (hrStars) {
                    hrStars.innerHTML = '';
                    for (let i = 0; i < hrCount; i += 1) {
                        const star = document.createElement('i');
                        star.className = 'bi bi-star-fill';
                        hrStars.appendChild(star);
                    }
                }
                if (safetyCountEl) safetyCountEl.textContent = `${safetyCount} Safety`;
                if (hrCountEl) hrCountEl.textContent = `${hrCount} HR`;
            }

            function addPelanggaranItem() {
                const wrapper = document.createElement('div');
                wrapper.className = 'dynamic-item';
                wrapper.innerHTML = `
                    <div class="row g-3 align-items-end">
                        <div class="col-md-3">
                            <label class="form-label">Jenis</label>
                            <select class="form-select pel-jenis" name="PelanggaranItems[${pelIndex}].Jenis">
                                <option value="">--</option>
                                <option value="Safety">Safety</option>
                                <option value="HR">HR</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Kategori</label>
                            <select class="form-select" name="PelanggaranItems[${pelIndex}].Kategori">
                                <option value="">--</option>
                                <option value="SP1">SP1</option>
                                <option value="SP2">SP2</option>
                                <option value="SP3">SP3</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Tanggal</label>
                            <input type="date" class="form-control" name="PelanggaranItems[${pelIndex}].Tanggal" />
                        </div>
                        <div class="col-md-3 text-end">
                            <button type="button" class="btn btn-outline-danger btn-sm pel-remove">
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Keterangan</label>
                            <textarea class="form-control" rows="2" name="PelanggaranItems[${pelIndex}].Keterangan"></textarea>
                        </div>
                    </div>
                `;
                pelList.appendChild(wrapper);
                pelIndex += 1;
                pelEmpty.classList.add('d-none');
                updatePelanggaranStars();
            }

            btnAddPel?.addEventListener('click', addPelanggaranItem);
            pelList?.addEventListener('click', (e) => {
                const target = e.target.closest('.pel-remove');
                if (!target) return;
                target.closest('.dynamic-item')?.remove();
                if (!pelList.children.length) {
                    pelEmpty.classList.remove('d-none');
                }
                updatePelanggaranStars();
            });

            pelList?.addEventListener('change', (e) => {
                if (e.target.classList.contains('pel-jenis')) {
                    updatePelanggaranStars();
                }
            });

            const vaksinList = document.getElementById('vaksinList');
            const vaksinEmpty = document.getElementById('vaksinEmpty');
            const btnAddVaksin = document.getElementById('btnAddVaksin');
            let vaksinIndex = 0;

            function addVaksinItem() {
                const wrapper = document.createElement('div');
                wrapper.className = 'dynamic-item';
                wrapper.innerHTML = `
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label class="form-label">Jenis Vaksin</label>
                            <input class="form-control" name="VaksinItems[${vaksinIndex}].Jenis" placeholder="Covid-19, Hepatitis, dll" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Dosis</label>
                            <input class="form-control" name="VaksinItems[${vaksinIndex}].Dosis" placeholder="1 / 2 / Booster" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Tanggal</label>
                            <input type="date" class="form-control" name="VaksinItems[${vaksinIndex}].Tanggal" />
                        </div>
                        <div class="col-md-3 text-end">
                            <button type="button" class="btn btn-outline-danger btn-sm vaksin-remove">
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Keterangan</label>
                            <textarea class="form-control" rows="2" name="VaksinItems[${vaksinIndex}].Keterangan"></textarea>
                        </div>
                    </div>
                `;
                vaksinList.appendChild(wrapper);
                vaksinIndex += 1;
                vaksinEmpty.classList.add('d-none');
            }

            btnAddVaksin?.addEventListener('click', addVaksinItem);
            vaksinList?.addEventListener('click', (e) => {
                const target = e.target.closest('.vaksin-remove');
                if (!target) return;
                target.closest('.dynamic-item')?.remove();
                if (!vaksinList.children.length) {
                    vaksinEmpty.classList.remove('d-none');
                }
            });

            const pendidikanList = document.getElementById('pendidikanList');
            const pendidikanEmpty = document.getElementById('pendidikanEmpty');
            const btnAddPendidikan = document.getElementById('btnAddPendidikan');
            let pendidikanIndex = parseInt(pendidikanList?.dataset.index || '0', 10) || 0;

            function addPendidikanItem() {
                const wrapper = document.createElement('div');
                wrapper.className = 'dynamic-item';
                wrapper.innerHTML = `
                    <div class="row g-3 align-items-end">
                        <div class="col-md-2">
                            <label class="form-label">ID Pendidikan</label>
                            <input class="form-control" type="number" min="0" name="PendidikanItems[${pendidikanIndex}].IdPendidikan" />
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Nama Sekolah</label>
                            <input class="form-control" name="PendidikanItems[${pendidikanIndex}].NamaSekolah" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Fakultas</label>
                            <input class="form-control" name="PendidikanItems[${pendidikanIndex}].Fakultas" />
                        </div>
                        <div class="col-md-3 text-end">
                            <label class="form-label">Jurusan</label>
                            <input class="form-control" name="PendidikanItems[${pendidikanIndex}].Jurusan" />
                        </div>
                        <div class="col-12 text-end">
                            <button type="button" class="btn btn-outline-danger btn-sm pendidikan-remove">
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
                pendidikanList?.appendChild(wrapper);
                pendidikanIndex += 1;
                pendidikanEmpty?.classList.add('d-none');
            }

            btnAddPendidikan?.addEventListener('click', addPendidikanItem);
            pendidikanList?.addEventListener('click', (e) => {
                const target = e.target.closest('.pendidikan-remove');
                if (!target) return;
                target.closest('.dynamic-item')?.remove();
                if (!pendidikanList.children.length) {
                    pendidikanEmpty?.classList.remove('d-none');
                }
            });

            const dokInput = document.getElementById('dokumenInput');
            const dokBadge = document.getElementById('dokumenBadge');
            const dokCount = document.getElementById('dokumenCount');
            if (dokInput) {
                dokInput.addEventListener('change', () => {
                    const total = dokInput.files ? dokInput.files.length : 0;
                    dokCount.textContent = total ? `${total} file dipilih` : 'Belum ada file.';
                    if (dokBadge) {
                        dokBadge.style.display = total ? 'flex' : 'none';
                    }
                });
            }

            const provSelect = document.getElementById('provinsiSelect');
            const kabSelect = document.getElementById('kabupatenSelect');
            const kecSelect = document.getElementById('kecamatanSelect');
            const desaSelect = document.getElementById('desaSelect');

            function resetSelect(target, placeholder) {
                if (!target) return;
                target.innerHTML = `<option value="">${placeholder}</option>`;
            }

            async function loadProvinsi() {
                const response = await fetch('/api/wilayah/provinsi');
                const data = await response.json();
                resetSelect(provSelect, '-- Pilih Provinsi --');
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.name;
                    option.dataset.id = item.id;
                    option.textContent = item.name;
                    provSelect.appendChild(option);
                });

                const selectedName = provSelect?.dataset.selected;
                if (selectedName) {
                    provSelect.value = selectedName;
                    const selected = provSelect.options[provSelect.selectedIndex];
                    if (selected?.dataset.id) {
                        await loadKabupaten(selected.dataset.id);
                    }
                }
            }

            async function loadKabupaten(provId) {
                resetSelect(kabSelect, '-- Pilih Kabupaten --');
                resetSelect(kecSelect, '-- Pilih Kecamatan --');
                resetSelect(desaSelect, '-- Pilih Desa --');
                if (!provId) return;
                const response = await fetch(`/api/wilayah/kabupaten?provinsiId=${provId}`);
                const data = await response.json();
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.name;
                    option.dataset.id = item.id;
                    option.textContent = item.name;
                    kabSelect.appendChild(option);
                });

                const selectedName = kabSelect?.dataset.selected;
                if (selectedName) {
                    kabSelect.value = selectedName;
                    const selected = kabSelect.options[kabSelect.selectedIndex];
                    if (selected?.dataset.id) {
                        await loadKecamatan(selected.dataset.id);
                    }
                }
            }

            async function loadKecamatan(kabId) {
                resetSelect(kecSelect, '-- Pilih Kecamatan --');
                resetSelect(desaSelect, '-- Pilih Desa --');
                if (!kabId) return;
                const response = await fetch(`/api/wilayah/kecamatan?kabupatenId=${kabId}`);
                const data = await response.json();
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.name;
                    option.dataset.id = item.id;
                    option.textContent = item.name;
                    kecSelect.appendChild(option);
                });

                const selectedName = kecSelect?.dataset.selected;
                if (selectedName) {
                    kecSelect.value = selectedName;
                    const selected = kecSelect.options[kecSelect.selectedIndex];
                    if (selected?.dataset.id) {
                        await loadDesa(selected.dataset.id);
                    }
                }
            }

            async function loadDesa(kecId) {
                resetSelect(desaSelect, '-- Pilih Desa --');
                if (!kecId) return;
                const response = await fetch(`/api/wilayah/desa?kecamatanId=${kecId}`);
                const data = await response.json();
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.name;
                    option.dataset.id = item.id;
                    option.textContent = item.name;
                    desaSelect.appendChild(option);
                });

                const selectedName = desaSelect?.dataset.selected;
                if (selectedName) {
                    desaSelect.value = selectedName;
                }
            }

            provSelect?.addEventListener('change', () => {
                const selected = provSelect.options[provSelect.selectedIndex];
                loadKabupaten(selected?.dataset.id);
            });
            kabSelect?.addEventListener('change', () => {
                const selected = kabSelect.options[kabSelect.selectedIndex];
                loadKecamatan(selected?.dataset.id);
            });
            kecSelect?.addEventListener('change', () => {
                const selected = kecSelect.options[kecSelect.selectedIndex];
                loadDesa(selected?.dataset.id);
            });

            loadProvinsi();

            function renderOptions(selectEl, options, placeholder) {
                if (!selectEl) return;
                selectEl.innerHTML = `<option value="">${placeholder}</option>`;
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    selectEl.appendChild(opt);
                });

                const selected = selectEl.dataset.selected;
                if (selected) {
                    selectEl.value = selected;
                }
            }

            const klasifikasiOptions = [
                'MANAGEMENT',
                'TEKNISI',
                'TERAMPIL',
                'ADMINISTRASI',
                'TIDAK TERAMPIL',
                'PROFESIONAL'
            ];
            const gradeOptions = [];
            for (let i = 1; i <= 20; i += 1) {
                gradeOptions.push(`${i} SETARA`);
            }
            const tipeKaryawanOptions = ['STAF', 'NON STAF'];
            const rosterOptions = ['10:2', '7:2', '6:2', 'OTHER'];
            const lokasiPenerimaanOptions = [
                'NON LOKAL - LUAR KALTIM',
                'RING II (DAERAH KUTIM SELAIN DALAM RING I)',
                'RING III (DI LUAR KUTIM DAN DIDALAM KALTIM)',
                'RING I (KALIORANG/KARANGAN/KAUBUN/SANGKULIRANG)'
            ];
            const lokasiKerjaOptions = [
                'BALIKPAPAN (IC)',
                'HEAD OFFICE SANGKULIRANG PERMAI (IC)',
                'JOIN OPERATION IC & GAM (IC)',
                'MSF CPP 33 (IC)',
                'MSF PORT (IC)',
                'OFFICE KM 14 (IC)',
                'SANGATTA (IC)',
                'OFFICE (MITRA)',
                'WORKSHOP (MITRA)',
                'MESS (MITRA)',
                'TAMBANG (MITRA)',
                'CPP (MITRA)',
                'PORT (MITRA)',
                'OTHER (MITRA)'
            ];
            const statusResidenceOptions = [
                'RESIDENT (MESS)',
                'NON RESIDENT (NON MESS)'
            ];

            const gradeSelect = document.getElementById('gradeSelect');
            const klasifikasiSelect = document.getElementById('klasifikasiSelect');
            const golonganSelect = document.getElementById('golonganSelect');
            const rosterSelect = document.getElementById('rosterSelect');
            const lokasiPenerimaanSelect = document.getElementById('lokasiPenerimaanSelect');
            const lokasiKerjaSelect = document.getElementById('lokasiKerjaSelect');
            const statusResidenceSelect = document.getElementById('statusResidenceSelect');
            const pohSelect = document.getElementById('pohSelect');

            renderOptions(gradeSelect, gradeOptions, '-- Pilih --');
            renderOptions(klasifikasiSelect, klasifikasiOptions, '-- Pilih --');
            renderOptions(golonganSelect, tipeKaryawanOptions, '-- Pilih --');
            renderOptions(rosterSelect, rosterOptions, '-- Pilih --');
            renderOptions(lokasiPenerimaanSelect, lokasiPenerimaanOptions, '-- Pilih --');
            renderOptions(lokasiKerjaSelect, lokasiKerjaOptions, '-- Pilih --');
            renderOptions(statusResidenceSelect, statusResidenceOptions, '-- Pilih --');

            async function loadPohOptions() {
                if (!pohSelect) return;
                pohSelect.innerHTML = '<option value="">-- Pilih POH --</option>';
                pohSelect.appendChild(new Option('LOCAL', 'LOCAL'));
                const response = await fetch('/api/wilayah/provinsi');
                const data = await response.json();
                data.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item.name;
                    opt.textContent = item.name;
                    pohSelect.appendChild(opt);
                });

                const selected = pohSelect.dataset.selected;
                if (selected) {
                    pohSelect.value = selected;
                }
            }

            loadPohOptions();
        })();
    </script>
}
