ONE DB MITRA - RINGKASAN PROYEK

Tujuan
- Aplikasi admin ASP.NET Core MVC + EF Core (DB-first).
- Semua menu dan akses ditentukan dari database (bukan hardcode).
- Relasi tidak memakai FK di DB (ditangani di aplikasi).

Struktur Hirarki
- Hirarki perusahaan: Owner -> Main Contractor -> Sub Contractor -> Vendor.
- Hirarki organisasi internal: Perusahaan -> Departemen -> Seksi -> Jabatan.
- Hirarki perusahaan dibentuk dari kolom tbl_m_perusahaan.perusahaan_induk_id (bebas level/cabang).

Peran dan Akses
- Owner bisa melihat semua data di bawahnya.
- Admin perusahaan (user tanpa departemen_id) melihat seluruh data di bawah perusahaannya.
- Admin departemen hanya melihat data departemennya sendiri.
- Admin peran hanya bisa membuat user di level sama/di bawahnya.
- Admin departemen tidak boleh membuat peran baru, hanya user di departemennya.
- Menu akses per role diatur oleh Owner saja.
- Badge "Scope" tampil di topbar semua halaman.

Menu dan Navigasi
- Menu sidebar dibentuk dari tbl_m_menu + mapping tbl_r_menu_peran / tbl_r_menu_perusahaan.
- Menu bisa ditambah/kurangi dari DB tanpa redeploy.
- Role-based menu rendering (hanya yang diizinkan).

User Management
- User bisa multi-role + role switcher di topbar.
- Password disimpan plaintext (sesuai permintaan).
- Foto profil tersimpan di wwwroot/uploads/profile.

Karyawan (HR)
- Tabel utama: tbl_t_karyawan (dulu tbl_m_karyawan).
- Data personal di tbl_m_personal.
- Status karyawan: aktif, nonaktif, blacklist.
- Nonaktif wajib alasan (resign/other).
- Blacklist tidak bisa diaktifkan kembali kecuali Owner.
- Pindah perusahaan minimal 3 bulan dari tanggal resign/nonaktif.
- Jika kurang dari 3 bulan, hanya Owner yang bisa override.
- Riwayat penempatan/karyawan dicatat untuk tracking perpindahan.
- Excel upload + template download untuk input massal.
- Validasi duplikasi no_ktp/no_kk/no_nik.

Email Notifikasi
- SMTP setting di tbl_m_email_setting.
- Email queue di tbl_m_email_notifikasi.
- Saat buat user/reset password, simpan notifikasi dan kirim via background worker.

Skema DB Terkait Organisasi (per 2026-01-16)
- tbl_m_perusahaan: id, kode_perusahaan, nama_perusahaan, alamat_perusahaan, status_perusahaan,
  tipe_perusahaan_id, perusahaan_induk_id, status_aktif (bit), created_at, updated_at, deleted_at.
- tbl_m_departemen: id, kode_departemen, nama_departemen, keterangan, status_aktif (varchar),
  id_perusahaan, created_at.
- tbl_m_seksi: id, kode_seksi, nama_seksi, keterangan, status_seksi, id_departemen,
  id_perusahaan, status_aktif (bit), created_at, updated_at, deleted_at.
- tbl_m_jabatan: id, kode_jabatan, nama_jabatan, keterangan, status_jabatan, status_aktif (varchar),
  id_perusahaan, id_seksi, created_at, updated_at, deleted_at.
- Catatan: status_aktif di departemen/jabatan bertipe varchar; aplikasi mengonversi ke bool.
- Catatan: id_seksi pada jabatan bisa NULL; UI jabatan sudah pakai left join agar tetap tampil.

UI/UX
- Tema, font, dan layout modern.
- Announcement banner terjadwal di header.
- Onboarding checklist, audit log, activity timeline/heatmap.
- Tidak ada tombol delete karyawan; hanya edit, nonaktif, atau blacklist.

Catatan Teknis
- Gunakan appsettings PrimarySqlServer untuk koneksi.
- Perubahan skema DB dilakukan manual (tanpa migration).
